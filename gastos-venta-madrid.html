<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Gastos de Venta - Madrid</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: white;
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 0;
            box-shadow: none;
            overflow: hidden;
            min-height: 100vh;
        }

        .header {
            background: white;
            color: #333;
            padding: 40px 30px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
            margin: 0 0 20px 0;
            line-height: 1.2;
        }

        .content {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 30px;
        }

        label {
            display: block;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
        }

        .campo-explicacion {
            font-size: 13px;
            color: #666;
            margin-top: 5px;
            margin-bottom: 12px;
            line-height: 1.4;
            font-style: italic;
        }

        .slider-container {
            position: relative;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .slider-value {
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 10px;
        }

        .radio-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .radio-option {
            flex: 1;
            padding: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            font-weight: 600;
            background: #f8f9fa;
        }

        .radio-option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .radio-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .subsection {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        .subsection.visible {
            display: block;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }

        .checkbox-item:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .checkbox-item.selected {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
        }

        .checkbox-item label {
            flex: 1;
            margin: 0;
            font-size: 15px;
            cursor: pointer;
        }

        .checkbox-item .price {
            font-weight: 700;
            color: #667eea;
            font-size: 15px;
        }

        .btn-calcular {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 30px;
        }

        .btn-calcular:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.modal-visible {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 0;
            max-width: 500px;
            width: 100%;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            border-radius: 20px 20px 0 0;
            position: relative;
        }

        .close-x {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 40px;
            color: rgba(255,255,255,0.6);
            cursor: pointer;
            line-height: 1;
            transition: color 0.3s;
        }

        .close-x:hover {
            color: white;
        }

        .modal-body {
            padding: 30px;
        }

        .resultado-item {
            background: rgba(255,255,255,0.15);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .resultado-item strong {
            display: block;
            font-size: 14px;
            margin-bottom: 5px;
            color: #666;
        }

        .resultado-item .valor {
            font-size: 18px;
            font-weight: 700;
            color: #667eea;
        }

        .resultado-destacado {
            background: rgba(102, 126, 234, 0.1);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin: 20px 0;
            border: 2px solid #667eea;
        }

        .resultado-destacado strong {
            display: block;
            font-size: 16px;
            color: #666;
            margin-bottom: 10px;
        }

        .resultado-destacado .valor-grande {
            font-size: 32px;
            font-weight: 700;
            color: #667eea;
        }

        .desglose-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid #e0e0e0;
        }

        .desglose-section h3 {
            color: #667eea;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .desglose-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .desglose-item:last-child {
            border-bottom: none;
        }

        .desglose-item .concepto {
            font-size: 15px;
            color: #666;
        }

        .desglose-item .importe {
            font-weight: 700;
            color: #333;
            font-size: 15px;
        }

        .agente-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-top: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .agente-foto {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: block;
            border: 3px solid #667eea;
            object-fit: cover;
        }

        .agente-texto {
            text-align: center;
            font-size: 16px;
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        #whatsappBtn {
            display: block;
            width: 100%;
            padding: 18px;
            background: #25D366;
            color: white;
            text-align: center;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 16px;
            transition: all 0.3s;
        }

        #whatsappBtn:hover {
            background: #20BA5A;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4);
        }

        .aviso-legal {
            background: rgba(102, 126, 234, 0.1);
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            color: #666;
            text-align: center;
            margin-top: 20px;
            border-left: 4px solid #667eea;
        }

        @media (max-width: 600px) {
            .header h1 {
                font-size: 24px;
            }

            .content {
                padding: 20px;
            }

            .slider-value {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Calculadora de<br>Gastos de Venta</h1>
            <div style="display: flex; align-items: center; justify-content: center; margin-top: 15px;">
                <img src="https://raw.githubusercontent.com/inmokit/calculadoras/refs/heads/main/ayuntamiento-madrid.jpg" alt="Ayuntamiento de Madrid" style="height: 70px; width: auto;" onerror="this.onerror=null; this.src='https://raw.githubusercontent.com/inmokit/calculadoras/refs/heads/main/pepa-barros.jpg';">
            </div>
        </div>

        <div class="content">
            <!-- PRECIO DE VENTA -->
            <div class="form-group">
                <label>üí∞ Precio de venta</label>
                <div class="slider-value" id="precioVentaDisplay">250.000 ‚Ç¨</div>
                <input type="range" id="precioVenta" min="50000" max="2000000" step="10000" value="250000">
                <p class="campo-explicacion">üìã Es el precio al que vendes la vivienda. Incluye el importe total que recibir√°s del comprador.</p>
            </div>

            <!-- A√ëOS DE PROPIEDAD -->
            <div class="form-group">
                <label>üìÖ A√±os de propiedad</label>
                <div class="slider-value" id="aniosPropiedadDisplay">10 a√±os</div>
                <input type="range" id="aniosPropiedad" min="1" max="50" step="1" value="10">
                <p class="campo-explicacion">üìã A√±os completos que has sido propietario de la vivienda. Necesario para calcular la plusval√≠a municipal.</p>
            </div>

            <!-- VALOR CATASTRAL SUELO -->
            <div class="form-group">
                <label>üåç Valor catastral del suelo</label>
                <div class="slider-value" id="valorSueloDisplay">70.000 ‚Ç¨</div>
                <input type="range" id="valorSuelo" min="10000" max="500000" step="5000" value="70000">
                <p class="campo-explicacion">üìã Lo encuentras en tu recibo del IBI, apartado "Valor Catastral del Suelo".</p>
            </div>

            <!-- VALOR CATASTRAL TOTAL -->
            <div class="form-group">
                <label>üè¢ Valor catastral total</label>
                <div class="slider-value" id="valorTotalDisplay">150.000 ‚Ç¨</div>
                <input type="range" id="valorTotal" min="50000" max="1000000" step="5000" value="150000">
                <p class="campo-explicacion">üìã En tu recibo del IBI, apartado "Valor Catastral" o "Base Imponible". Es la suma del valor del suelo + construcci√≥n.</p>
            </div>

            <!-- HONORARIOS INMOBILIARIA -->
            <div class="form-group">
                <label>üè™ Honorarios inmobiliaria</label>
                <div class="slider-value" id="comisionDisplay">5.0%</div>
                <input type="range" id="comision" min="0" max="10" step="0.5" value="5">
                <p class="campo-explicacion">üìã Porcentaje para la inmobiliaria por gestionar todo el proceso la venta, tr√°mites, burocracia, visitas, negociaci√≥n, optimizaci√≥n fiscal, etc... Normalmente entre 4% y 6%.</p>
            </div>

            <!-- ¬øTIENE HIPOTECA? -->
            <div class="form-group">
                <label>üè¶ ¬øTiene hipoteca pendiente?</label>
                <div class="radio-group">
                    <div class="radio-option" id="hipotecaSi" onclick="selectHipoteca('si')">S√≠</div>
                    <div class="radio-option selected" id="hipotecaNo" onclick="selectHipoteca('no')">No</div>
                </div>
            </div>

            <!-- SUBSECCI√ìN HIPOTECA -->
            <div class="subsection" id="subseccionHipoteca">
                <div class="form-group">
                    <label>üí≥ Capital pendiente de amortizar</label>
                    <div class="slider-value" id="capitalPendienteDisplay">80.000 ‚Ç¨</div>
                    <input type="range" id="capitalPendiente" min="0" max="500000" step="5000" value="80000">
                    <p class="campo-explicacion">üìã Cantidad que a√∫n debes al banco. Lo puedes consultar en tu √∫ltima liquidaci√≥n hipotecaria o llamando al banco.</p>
                </div>

                <div class="form-group">
                    <label>üìä Comisi√≥n cancelaci√≥n anticipada</label>
                    <div class="slider-value" id="comisionCancelacionDisplay">1.0%</div>
                    <input type="range" id="comisionCancelacion" min="0" max="3" step="0.1" value="1">
                    <p class="campo-explicacion">üìã Penalizaci√≥n que cobra el banco por cancelar antes de tiempo. Suele ser entre 0.5% y 2% del capital pendiente.</p>
                </div>
            </div>

            <!-- CERTIFICADOS Y DOCUMENTOS -->
            <div class="form-group">
                <label>üìú Certificados y documentos obligatorios</label>
                <p class="campo-explicacion">üìã Marca los certificados que necesitas obtener para la venta:</p>
                <div class="checkbox-group">
                    <div class="checkbox-item" onclick="toggleCheckbox('certEnergetico')">
                        <input type="checkbox" id="certEnergetico" checked>
                        <label for="certEnergetico">Certificado de Eficiencia Energ√©tica</label>
                        <span class="price">200 ‚Ç¨</span>
                    </div>
                    <div class="checkbox-item" onclick="toggleCheckbox('notaSimple')">
                        <input type="checkbox" id="notaSimple" checked>
                        <label for="notaSimple">Nota Simple Registral</label>
                        <span class="price">10 ‚Ç¨</span>
                    </div>
                </div>
            </div>

            <!-- GESTOR√çA -->
            <div class="form-group">
                <label>üìã Gestor√≠a</label>
                <div class="slider-value" id="gestoriaDisplay">300 ‚Ç¨</div>
                <input type="range" id="gestoria" min="0" max="1000" step="50" value="300">
                <p class="campo-explicacion">üìã Coste de tramitaci√≥n de documentos y gestiones. Puede variar seg√∫n la complejidad de la venta.</p>
            </div>

            <!-- GASTOS COMUNIDAD PENDIENTES -->
            <div class="form-group">
                <label>üèòÔ∏è Gastos de comunidad pendientes</label>
                <div class="slider-value" id="comunidadDisplay">0 ‚Ç¨</div>
                <input type="range" id="comunidad" min="0" max="5000" step="100" value="0">
                <p class="campo-explicacion">üìã Cuotas de comunidad que a√∫n no has pagado. El vendedor debe abonarlas antes de la venta.</p>
            </div>

            <!-- DERRAMAS EXTRAORDINARIAS -->
            <div class="form-group">
                <label>üîß Derramas extraordinarias</label>
                <div class="slider-value" id="derramasDisplay">0 ‚Ç¨</div>
                <input type="range" id="derramas" min="0" max="10000" step="500" value="0">
                <p class="campo-explicacion">üìã Gastos extraordinarios aprobados por la comunidad (obras, reparaciones). Debes pagarlas antes de vender.</p>
            </div>

            <!-- IBI PENDIENTE -->
            <div class="form-group">
                <label>üèõÔ∏è IBI pendiente del a√±o en curso</label>
                <div class="slider-value" id="ibiDisplay">0 ‚Ç¨</div>
                <input type="range" id="ibi" min="0" max="3000" step="50" value="0">
                <p class="campo-explicacion">üìã Parte proporcional del IBI del a√±o que a√∫n no has pagado. Se prorratea seg√∫n los d√≠as del a√±o que has sido propietario.</p>
            </div>

            <!-- REPARACIONES -->
            <div class="form-group">
                <label>üî® Reparaciones necesarias antes de vender</label>
                <div class="slider-value" id="reparacionesDisplay">0 ‚Ç¨</div>
                <input type="range" id="reparaciones" min="0" max="20000" step="500" value="0">
                <p class="campo-explicacion">üìã Arreglos que debes hacer antes de la venta (pintura, fontaner√≠a, etc.). Es opcional pero puede mejorar el precio final.</p>
            </div>

            <button class="btn-calcular" onclick="calcularGastos()">üí∞ Calcular Gastos Totales</button>
        </div>
    </div>

    <!-- MODAL RESULTADO -->
    <div class="modal" id="modalResultado">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close-x" onclick="cerrarModal()">√ó</span>
                <h2 style="margin: 0; font-size: 24px;">üìä Gastos de Venta</h2>
                <p style="margin-top: 10px; opacity: 0.9; font-size: 16px;">Desglose completo de todos los gastos</p>
            </div>

            <div class="modal-body" id="contenidoResultado"></div>

            <div class="modal-body">
                <div class="agente-card">
                    <img src="https://raw.githubusercontent.com/inmokit/calculadoras/refs/heads/main/pepa-barros.jpg" alt="Pepa Barros" class="agente-foto">
                    <p class="agente-texto">¬øNecesitas ayuda con la venta de tu vivienda?<br><strong>Puedo gestionarte todos estos tr√°mites.</strong></p>
                    <a id="whatsappBtn" href="#" target="_blank">üí¨ Consultar por WhatsApp</a>
                </div>

                <div class="aviso-legal">
                    ‚ö†Ô∏è <strong>C√°lculo estimado.</strong> Los gastos reales pueden variar. Consulta con un profesional para un c√°lculo exacto.
                </div>
            </div>
        </div>
    </div>

    <script>
        let tieneHipoteca = false;

        // Sliders
        const sliders = {
            precioVenta: { slider: document.getElementById('precioVenta'), display: document.getElementById('precioVentaDisplay'), suffix: ' ‚Ç¨' },
            aniosPropiedad: { slider: document.getElementById('aniosPropiedad'), display: document.getElementById('aniosPropiedadDisplay'), suffix: ' a√±os' },
            valorSuelo: { slider: document.getElementById('valorSuelo'), display: document.getElementById('valorSueloDisplay'), suffix: ' ‚Ç¨' },
            valorTotal: { slider: document.getElementById('valorTotal'), display: document.getElementById('valorTotalDisplay'), suffix: ' ‚Ç¨' },
            comision: { slider: document.getElementById('comision'), display: document.getElementById('comisionDisplay'), suffix: '%' },
            capitalPendiente: { slider: document.getElementById('capitalPendiente'), display: document.getElementById('capitalPendienteDisplay'), suffix: ' ‚Ç¨' },
            comisionCancelacion: { slider: document.getElementById('comisionCancelacion'), display: document.getElementById('comisionCancelacionDisplay'), suffix: '%' },
            gestoria: { slider: document.getElementById('gestoria'), display: document.getElementById('gestoriaDisplay'), suffix: ' ‚Ç¨' },
            comunidad: { slider: document.getElementById('comunidad'), display: document.getElementById('comunidadDisplay'), suffix: ' ‚Ç¨' },
            derramas: { slider: document.getElementById('derramas'), display: document.getElementById('derramasDisplay'), suffix: ' ‚Ç¨' },
            ibi: { slider: document.getElementById('ibi'), display: document.getElementById('ibiDisplay'), suffix: ' ‚Ç¨' },
            reparaciones: { slider: document.getElementById('reparaciones'), display: document.getElementById('reparacionesDisplay'), suffix: ' ‚Ç¨' }
        };

        Object.keys(sliders).forEach(key => {
            const { slider, display, suffix } = sliders[key];
            slider.addEventListener('input', function() {
                let value = parseFloat(this.value);
                if (suffix === ' ‚Ç¨') {
                    display.textContent = value.toLocaleString('es-ES') + suffix;
                } else if (suffix === '%') {
                    display.textContent = value.toFixed(1) + suffix;
                } else {
                    display.textContent = value + suffix;
                }
            });
        });

        function selectHipoteca(opcion) {
            const btnSi = document.getElementById('hipotecaSi');
            const btnNo = document.getElementById('hipotecaNo');
            const subseccion = document.getElementById('subseccionHipoteca');

            if (opcion === 'si') {
                btnSi.classList.add('selected');
                btnNo.classList.remove('selected');
                subseccion.classList.add('visible');
                tieneHipoteca = true;
            } else {
                btnSi.classList.remove('selected');
                btnNo.classList.add('selected');
                subseccion.classList.remove('visible');
                tieneHipoteca = false;
            }
        }

        function toggleCheckbox(id) {
            const checkbox = document.getElementById(id);
            const item = checkbox.closest('.checkbox-item');
            checkbox.checked = !checkbox.checked;
            if (checkbox.checked) {
                item.classList.add('selected');
            } else {
                item.classList.remove('selected');
            }
        }

        function calcularGastos() {
            const precioVenta = parseFloat(sliders.precioVenta.slider.value);
            const aniosPropiedad = parseInt(sliders.aniosPropiedad.slider.value);
            const valorSuelo = parseFloat(sliders.valorSuelo.slider.value);
            const valorTotal = parseFloat(sliders.valorTotal.slider.value);
            const comisionPct = parseFloat(sliders.comision.slider.value);
            const capitalPendiente = tieneHipoteca ? parseFloat(sliders.capitalPendiente.slider.value) : 0;
            const comisionCancelacionPct = tieneHipoteca ? parseFloat(sliders.comisionCancelacion.slider.value) : 0;
            const gestoria = parseFloat(sliders.gestoria.slider.value);
            const comunidad = parseFloat(sliders.comunidad.slider.value);
            const derramas = parseFloat(sliders.derramas.slider.value);
            const ibi = parseFloat(sliders.ibi.slider.value);
            const reparaciones = parseFloat(sliders.reparaciones.slider.value);

            // Certificados
            const certEnergetico = document.getElementById('certEnergetico').checked ? 200 : 0;
            const notaSimple = document.getElementById('notaSimple').checked ? 10 : 0;

            // Validaciones
            if (valorSuelo > valorTotal) {
                alert('‚ùå El valor del suelo no puede ser mayor que el valor total catastral');
                return;
            }

            // 1. PLUSVAL√çA MUNICIPAL (usando coeficientes Madrid 2025)
            const coeficientes = {
                1: 0.15, 2: 0.14, 3: 0.15, 4: 0.16, 5: 0.18,
                6: 0.19, 7: 0.20, 8: 0.15, 9: 0.12, 10: 0.10,
                11: 0.08, 12: 0.07, 13: 0.07, 14: 0.07, 15: 0.07,
                16: 0.08, 17: 0.13, 18: 0.17, 19: 0.23, 20: 0.40
            };
            const periodo = Math.min(aniosPropiedad, 20);
            const coef = coeficientes[periodo] || 0.40;
            const baseImponiblePlusvalia = valorSuelo * coef;
            const tipoImpositivo = 0.29; // 29% Madrid
            const plusvalia = baseImponiblePlusvalia * tipoImpositivo;

            // 2. COMISI√ìN INMOBILIARIA
            const comisionInmo = precioVenta * (comisionPct / 100);

            // 3. HIPOTECA (si tiene)
            let gastosHipoteca = 0;
            let comisionBancaria = 0;
            let notariaCancelacion = 0;
            let registroCancelacion = 0;

            if (tieneHipoteca && capitalPendiente > 0) {
                comisionBancaria = capitalPendiente * (comisionCancelacionPct / 100);
                notariaCancelacion = 150; // Estimado
                registroCancelacion = 80; // Estimado
                gastosHipoteca = comisionBancaria + notariaCancelacion + registroCancelacion;
            }

            // 4. CERTIFICADOS
            const totalCertificados = certEnergetico + notaSimple;

            // 5. TOTAL
            const totalGastos = plusvalia + comisionInmo + gastosHipoteca + totalCertificados + 
                               gestoria + comunidad + derramas + ibi + reparaciones;

            // RESULTADO
            let resultado = `
                <div class="resultado-destacado">
                    <strong>üí∞ TOTAL GASTOS DE VENTA</strong>
                    <div class="valor-grande">${totalGastos.toFixed(0).toLocaleString('es-ES')} ‚Ç¨</div>
                </div>

                <div class="desglose-section">
                    <h3>üìã Desglose Detallado</h3>
                    
                    <div class="desglose-item">
                        <span class="concepto">üèõÔ∏è Plusval√≠a Municipal (${periodo} a√±os)</span>
                        <span class="importe">${plusvalia.toFixed(0).toLocaleString('es-ES')} ‚Ç¨</span>
                    </div>

                    <div class="desglose-item">
                        <span class="concepto">üè™ Comisi√≥n Inmobiliaria (${comisionPct}%)</span>
                        <span class="importe">${comisionInmo.toFixed(0).toLocaleString('es-ES')} ‚Ç¨</span>
                    </div>
            `;

            if (tieneHipoteca && capitalPendiente > 0) {
                resultado += `
                    <div class="desglose-item">
                        <span class="concepto">üè¶ Comisi√≥n cancelaci√≥n hipoteca (${comisionCancelacionPct}%)</span>
                        <span class="importe">${comisionBancaria.toFixed(0).toLocaleString('es-ES')} ‚Ç¨</span>
                    </div>
                    <div class="desglose-item">
                        <span class="concepto">üìú Notar√≠a cancelaci√≥n hipoteca</span>
                        <span class="importe">${notariaCancelacion.toFixed(0).toLocaleString('es-ES')} ‚Ç¨</span>
                    </div>
                    <div class="desglose-item">
                        <span class="concepto">üìã Registro cancelaci√≥n hipoteca</span>
                        <span class="importe">${registroCancelacion.toFixed(0).toLocaleString('es-ES')} ‚Ç¨</span>
                    </div>
                `;
            }

            if (certEnergetico > 0) {
                resultado += `
                    <div class="desglose-item">
                        <span class="concepto">‚ö° Certificado Eficiencia Energ√©tica</span>
                        <span class="importe">${certEnergetico} ‚Ç¨</span>
                    </div>
                `;
            }

            if (notaSimple > 0) {
                resultado += `
                    <div class="desglose-item">
                        <span class="concepto">üìÑ Nota Simple Registral</span>
                        <span class="importe">${notaSimple} ‚Ç¨</span>
                    </div>
                `;
            }

            if (gestoria > 0) {
                resultado += `
                    <div class="desglose-item">
                        <span class="concepto">üìã Gestor√≠a</span>
                        <span class="importe">${gestoria.toFixed(0).toLocaleString('es-ES')} ‚Ç¨</span>
                    </div>
                `;
            }

            if (comunidad > 0) {
                resultado += `
                    <div class="desglose-item">
                        <span class="concepto">üèòÔ∏è Gastos comunidad pendientes</span>
                        <span class="importe">${comunidad.toFixed(0).toLocaleString('es-ES')} ‚Ç¨</span>
                    </div>
                `;
            }

            if (derramas > 0) {
                resultado += `
                    <div class="desglose-item">
                        <span class="concepto">üîß Derramas extraordinarias</span>
                        <span class="importe">${derramas.toFixed(0).toLocaleString('es-ES')} ‚Ç¨</span>
                    </div>
                `;
            }

            if (ibi > 0) {
                resultado += `
                    <div class="desglose-item">
                        <span class="concepto">üèõÔ∏è IBI pendiente</span>
                        <span class="importe">${ibi.toFixed(0).toLocaleString('es-ES')} ‚Ç¨</span>
                    </div>
                `;
            }

            if (reparaciones > 0) {
                resultado += `
                    <div class="desglose-item">
                        <span class="concepto">üî® Reparaciones</span>
                        <span class="importe">${reparaciones.toFixed(0).toLocaleString('es-ES')} ‚Ç¨</span>
                    </div>
                `;
            }

            resultado += `
                </div>

                <div style="margin-top: 25px; padding: 20px; background: #f8f9ff; border-radius: 12px; border-left: 4px solid #667eea;">
                    <h3 style="color: #667eea; font-size: 18px; margin-bottom: 10px;">üí° Resumen</h3>
                    <p style="font-size: 15px; color: #666; line-height: 1.6; margin: 0;">
                        De los <strong>${precioVenta.toLocaleString('es-ES')} ‚Ç¨</strong> del precio de venta, 
                        deducidos los <strong>${totalGastos.toFixed(0).toLocaleString('es-ES')} ‚Ç¨</strong> de gastos, 
                        recibir√°s aproximadamente <strong style="color: #667eea;">${(precioVenta - totalGastos).toFixed(0).toLocaleString('es-ES')} ‚Ç¨</strong> netos.
                    </p>
                </div>
            `;

            document.getElementById('contenidoResultado').innerHTML = resultado;

            // WhatsApp
            const mensajeWhatsApp = encodeURIComponent(
                `Hola Pepa, acabo de calcular los gastos de venta de mi vivienda en Madrid.\n\n` +
                `üí∞ Precio de venta: ${precioVenta.toLocaleString('es-ES')}‚Ç¨\n` +
                `üìä Gastos totales: ${totalGastos.toFixed(0).toLocaleString('es-ES')}‚Ç¨\n` +
                `‚úÖ Beneficio neto: ${(precioVenta - totalGastos).toFixed(0).toLocaleString('es-ES')}‚Ç¨\n\n` +
                `¬øPuedes ayudarme con la venta?`
            );
            document.getElementById('whatsappBtn').href = `https://wa.me/34689487900?text=${mensajeWhatsApp}`;

            document.getElementById('modalResultado').classList.add('modal-visible');
            document.body.style.overflow = 'hidden';
        }

        function cerrarModal() {
            document.getElementById('modalResultado').classList.remove('modal-visible');
            document.body.style.overflow = '';
        }
    </script>
</body>
</html>